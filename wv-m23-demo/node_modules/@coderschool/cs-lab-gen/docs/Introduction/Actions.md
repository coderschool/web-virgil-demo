# The action

A `labgen` action consists of metadata and a body.

The metadata is similar to a header of markdown-like frontmatter. It is delimited by a matching `---` top and bottom. Example:

```
---
to: package.json
inject: true
after: dependencies
skip_if: lodash
---

"lodash":"*",
```

## Shell actions

Shell actions give you the ability to trigger any shell commands. For example:

- Create files and folders
- Trigger `npm install`, start the project `npm start`
- Move to the project folder `cd your_project`

Here is how to create a folder and move into it:

```
---
sh: mkdir intro-react && cd intro-react
---

The body of this action will be ignored.
```

Using just the `sh` property, `labgen` will understand this is a shell action.

### Changing working directory

Running the command `cd` only affects the shell process that `cd` is run on. To actually change the working directory, you can add the property `change_process_dir:`:

```bash
---
sh: cd ./project-folder
change_process_dir: ./project-folder
---
```

Now if you run shell actions like `npm install` it will install to the `project-folder`.

> Notice that the relative path defined by the property `to:` in addition/injection actions is now relative to `project-folder/`.

## Addition actions

Addition actions can add files to your project by specifying `to:` property. `labgen` will also create the folders containing the file recursively.

```javascript
---
to: intro-react/src/index.js
---

console.log("Overwrite the index.js");
```

If the file already exists, `labgen` will skip this action. You can force it to overwrite the file no matter what by specifying `force: true`:

```javascript
---
to: intro-react/src/index.js
force: true
---

console.log("Overwrite the index.js no matter what");
```

Or you can use `unless_exists` to create the file only when it doesn't exist:

```javascript
---
to: intro-react/src/index.js
unless_exists: true
---

console.log("Does not render if the file exists");
```

## Injection

You can modify an existing target file. For this to work, you need to use `inject: true`:

```
---
to: intro-react/package.json
inject: true
after: dependencies
skip_if: axios
---

"axios":"*",
```

This template will add the `axios` dependency into the `package.json` file, but it will not add it twice because of `skip_if`.

Here are available properties for an `inject: true` template:

- `before` or `after` contain a regular expression of text to locate. The inject line will appear before or after the located line.
- `prepend` or `append`, when true, add a line to start or end of file respectively.
- `at_line` contains a line number will add a line at this exact line number.
- `remove_lines` contains its properties to define which lines to be removed.

In almost all cases, you want to ensure you're not injecting content twice:

- `skip_if` which contains a regular expression / text. If it exists, injection is skipped.

### Remove lines

In software development, we need to refactor the code continuously. Refactoring is basically replacing, which contains two steps removing and then injecting.

To remove lines in a target file, you need to use `remove_lines:`. It is a particular property because it contains its own properties:

```
---
to: intro-react/package.json
inject: true
remove_lines:
  at_line: 20
  to: 3
---

The body is ignored
```

This template will go to the `package.json` and remove 3 lines (defined by `to:`) starting from line number 20 (defined by `at_line:`)

You can also use `from` with a regular expression instead of a line number to locate the start line.

```
---
to: intro-react/package.json
inject: true
remove_lines:
  from: axios: "*",
  to: 1
---

This will remove the line of the dependency axios in the package.json
```

## All metadata properties

| Property                                            | Type                                 | Default                                        | Example                                |
| --------------------------------------------------- | ------------------------------------ | ---------------------------------------------- | -------------------------------------- |
| to:                                                 | String                               | undefined                                      | the-project/index.js                   |
| sh:                                                 | String                               | undefined                                      | echo "Hello labgen"                    |
| unless_exists:                                      | Boolean                              | false                                          | true                                   |
| force:                                              | Boolean                              | false                                          | true                                   |
| inject:                                             | Boolean                              | false                                          | true                                   |
| after:                                              | Regex                                | undefined                                      | \<h1>                                  |
| before:                                             | Regex                                | undefined                                      | import React                           |
| at_line:                                            | Number                               | undefined                                      | 1                                      |
| skip_if:                                            | Regex                                | undefined                                      | const variableName                     |
| <p>remove_lines:<br> from:<br> at_line:<br> to:</p> | <p><br>Regex<br>Number<br>Number</p> | <p><br>undefined<br>undefined<br>undefined</p> | <p><br>&#x3C;title>Intro<br>1<br>3</p> |
